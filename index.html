<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediScript Pro - AI-Powered Healthcare</title>
  <link rel="icon" href="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Roboto', -apple-system, sans-serif;
      background: #f8f9fa;
      color: #333;
    }
    
    :root {
      --primary: #14BEF0;
      --primary-dark: #0FA8D6;
      --success: #3AAA35;
      --danger: #E74C3C;
      --warning: #F39C12;
      --purple: #9B59B6;
      --text-dark: #2C3E50;
      --text-light: #7F8C8D;
      --border: #E0E0E0;
      --bg-light: #F8F9FA;
    }
    
    .header {
      background: white;
      border-bottom: 1px solid var(--border);
      padding: 16px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }
    
    .sidebar {
      width: 260px;
      background: white;
      border-right: 1px solid var(--border);
      padding: 24px 0;
      height: calc(100vh - 65px);
      position: sticky;
      top: 65px;
      overflow-y: auto;
    }
    
    .nav-item {
      padding: 14px 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-dark);
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
      font-size: 15px;
    }
    
    .nav-item:hover {
      background: #F0F9FF;
      color: var(--primary);
    }
    
    .nav-item.active {
      background: #E6F7FF;
      color: var(--primary);
      border-left: 3px solid var(--primary);
    }
    
    .nav-item svg {
      width: 20px;
      height: 20px;
    }
    
    .card {
      background: white;
      border-radius: 8px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: white;
      border-radius: 8px;
      padding: 24px;
      border: 1px solid var(--border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .stat-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      transform: translateY(-2px);
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: 700;
      color: var(--text-dark);
      margin: 8px 0;
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--text-light);
      font-weight: 500;
    }
    
    .btn {
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      box-shadow: 0 4px 12px rgba(20, 190, 240, 0.3);
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .btn-success:hover {
      background: #339930;
    }
    
    .btn-outline {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .form-group {
      margin-bottom: 20px;
      position: relative;
    }
    
    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 8px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s;
      background: white;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(20, 190, 240, 0.1);
    }
    
    .voice-input-wrapper {
      position: relative;
    }
    
    .voice-input-wrapper input,
    .voice-input-wrapper textarea {
      padding-right: 50px;
    }
    
    .mic-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--danger);
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      font-size: 16px;
    }
    
    .mic-btn:hover {
      background: #C0392B;
      transform: translateY(-50%) scale(1.1);
    }
    
    .mic-btn.listening {
      animation: pulse 1.5s infinite;
      background: var(--success);
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: translateY(-50%) scale(1); }
      50% { opacity: 0.7; transform: translateY(-50%) scale(1.1); }
    }
    
    .voice-badge {
      background: var(--danger);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .template-card {
      background: white;
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .template-card:hover {
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(20, 190, 240, 0.2);
      transform: translateY(-2px);
    }
    
    .template-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }
    
    .template-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-dark);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th {
      background: #F8F9FA;
      padding: 14px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
      color: var(--text-dark);
      border-bottom: 2px solid var(--border);
    }
    
    td {
      padding: 16px;
      border-bottom: 1px solid #F0F0F0;
      font-size: 14px;
      color: var(--text-dark);
    }
    
    tr:hover td {
      background: #F8F9FA;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      overflow-y: auto;
    }
    
    .modal.active { display: flex; }
    
    .modal-content {
      background: white;
      border-radius: 8px;
      padding: 32px;
      max-width: 1100px;
      max-height: 90vh;
      overflow-y: auto;
      width: 90%;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      margin: 20px;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .close-btn {
      font-size: 28px;
      color: var(--text-light);
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }
    
    .close-btn:hover {
      background: #F0F0F0;
      color: var(--text-dark);
    }
    
    .badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }
    
    .badge-primary { background: #E6F7FF; color: var(--primary); }
    .badge-success { background: #E8F5E9; color: var(--success); }
    .badge-warning { background: #FFF3E0; color: var(--warning); }
    .badge-danger { background: #FFEBEE; color: var(--danger); }
    
    .alert {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      border-left: 4px solid;
    }
    
    .alert-danger {
      background: #FFEBEE;
      border-color: var(--danger);
      color: #C62828;
    }
    
    .alert-warning {
      background: #FFF3E0;
      border-color: var(--warning);
      color: #E65100;
    }
    
    .alert-info {
      background: #E3F2FD;
      border-color: var(--primary);
      color: #1565C0;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .bmi-display {
      background: #E3F2FD;
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
      margin-top: 12px;
    }
    
    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 4px;
    }
    
    .page-subtitle {
      font-size: 14px;
      color: var(--text-light);
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <!-- Voice-Enabled Examination Modal -->
  <div id="examModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          ü©∫ Clinical Examination
          <span class="voice-badge">üé§ Voice Enabled</span>
        </div>
        <button class="close-btn" onclick="closeModal('examModal')">&times;</button>
      </div>
      
      <form onsubmit="saveExam(event)">
        <!-- Patient Selection -->
        <div class="form-group">
          <label class="form-label">Patient *</label>
          <select id="examPatient" class="form-input" required onchange="checkDrugSafety()"></select>
        </div>

        <!-- Safety Alerts -->
        <div id="safetyAlerts"></div>

        <!-- Quick Templates -->
        <div style="margin-bottom: 24px;">
          <div class="section-title">‚ö° Quick Templates</div>
          <div class="grid grid-cols-3 gap-3">
            <div class="template-card" onclick="applyTemplate('fever')">
              <div class="template-icon">ü§í</div>
              <div class="template-title">Fever</div>
            </div>
            <div class="template-card" onclick="applyTemplate('cold')">
              <div class="template-icon">ü§ß</div>
              <div class="template-title">Cold/Cough</div>
            </div>
            <div class="template-card" onclick="applyTemplate('gastritis')">
              <div class="template-icon">ü§¢</div>
              <div class="template-title">Gastritis</div>
            </div>
            <div class="template-card" onclick="applyTemplate('uti')">
              <div class="template-icon">üíß</div>
              <div class="template-title">UTI</div>
            </div>
            <div class="template-card" onclick="applyTemplate('hypertension')">
              <div class="template-icon">‚ù§Ô∏è</div>
              <div class="template-title">Hypertension</div>
            </div>
            <div class="template-card" onclick="applyTemplate('diabetes')">
              <div class="template-icon">ü©∏</div>
              <div class="template-title">Diabetes</div>
            </div>
          </div>
        </div>

        <!-- Vital Signs -->
        <div style="margin-bottom: 24px;">
          <div class="section-title">üìä Vital Signs</div>
          <div class="grid grid-cols-3 gap-4">
            <div class="form-group">
              <label class="form-label">BP</label>
              <div class="voice-input-wrapper">
                <input type="text" id="vitalBP" class="form-input" placeholder="120/80">
                <button type="button" class="mic-btn" onclick="startVoice('vitalBP')">üé§</button>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Temp</label>
              <div class="voice-input-wrapper">
                <input type="text" id="vitalTemp" class="form-input" placeholder="98.6¬∞F">
                <button type="button" class="mic-btn" onclick="startVoice('vitalTemp')">üé§</button>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Pulse</label>
              <div class="voice-input-wrapper">
                <input type="text" id="vitalPulse" class="form-input" placeholder="72">
                <button type="button" class="mic-btn" onclick="startVoice('vitalPulse')">üé§</button>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">SpO2</label>
              <div class="voice-input-wrapper">
                <input type="text" id="vitalSpO2" class="form-input" placeholder="98%">
                <button type="button" class="mic-btn" onclick="startVoice('vitalSpO2')">üé§</button>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Weight (kg)</label>
              <div class="voice-input-wrapper">
                <input type="number" id="vitalWeight" class="form-input" placeholder="70" onchange="calculateBMI()">
                <button type="button" class="mic-btn" onclick="startVoice('vitalWeight')">üé§</button>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Height (cm)</label>
              <div class="voice-input-wrapper">
                <input type="number" id="vitalHeight" class="form-input" placeholder="170" onchange="calculateBMI()">
                <button type="button" class="mic-btn" onclick="startVoice('vitalHeight')">üé§</button>
              </div>
            </div>
          </div>
          <div id="bmiDisplay" style="display: none;"></div>
        </div>

        <!-- Chief Complaint -->
        <div class="form-group">
          <label class="form-label">Chief Complaint * üé§</label>
          <div class="voice-input-wrapper">
            <textarea id="examComplaint" class="form-input" rows="2" required></textarea>
            <button type="button" class="mic-btn" onclick="startVoice('examComplaint')" style="top: 20px;">üé§</button>
          </div>
        </div>

        <!-- History of Present Illness -->
        <div class="form-group">
          <label class="form-label">History of Present Illness üé§</label>
          <div class="voice-input-wrapper">
            <textarea id="examHistory" class="form-input" rows="3"></textarea>
            <button type="button" class="mic-btn" onclick="startVoice('examHistory')" style="top: 30px;">üé§</button>
          </div>
        </div>

        <!-- Diagnosis -->
        <div class="form-group">
          <label class="form-label">Diagnosis * üé§</label>
          <div class="voice-input-wrapper">
            <input type="text" id="examDiagnosis" class="form-input" required>
            <button type="button" class="mic-btn" onclick="startVoice('examDiagnosis')">üé§</button>
          </div>
        </div>

        <!-- Treatment Plan -->
        <div class="form-group">
          <label class="form-label">Treatment Plan üé§</label>
          <div class="voice-input-wrapper">
            <textarea id="examTreatment" class="form-input" rows="4" onchange="checkDrugSafety()"></textarea>
            <button type="button" class="mic-btn" onclick="startVoice('examTreatment')" style="top: 30px;">üé§</button>
          </div>
        </div>

        <!-- Follow-up -->
        <div class="grid grid-cols-2 gap-4">
          <div class="form-group">
            <label class="form-label">Follow-up Date</label>
            <input type="date" id="examFollowup" class="form-input">
          </div>
          <div class="form-group">
            <label class="form-label">Follow-up Notes üé§</label>
            <div class="voice-input-wrapper">
              <input type="text" id="examFollowupNotes" class="form-input">
              <button type="button" class="mic-btn" onclick="startVoice('examFollowupNotes')">üé§</button>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-3 mt-6">
          <button type="submit" class="btn btn-success flex-1">‚úÖ Save Examination</button>
          <button type="button" onclick="generatePDF()" class="btn btn-primary">üìÑ Generate PDF</button>
          <button type="button" onclick="closeModal('examModal')" class="btn btn-outline">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Patient Modal -->
  <div id="patientModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Register New Patient</h2>
        <button class="close-btn" onclick="closeModal('patientModal')">&times;</button>
      </div>
      <form onsubmit="savePatient(event)">
        <div class="grid grid-cols-2 gap-4">
          <div class="form-group">
            <label class="form-label">First Name *</label>
            <input type="text" id="patFirstName" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Last Name *</label>
            <input type="text" id="patLastName" class="form-input" required>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-4">
          <div class="form-group">
            <label class="form-label">Age *</label>
            <input type="number" id="patAge" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Gender *</label>
            <select id="patGender" class="form-input">
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Blood Group</label>
            <select id="patBlood" class="form-input">
              <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
              <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="form-group">
            <label class="form-label">Phone Number *</label>
            <input type="tel" id="patPhone" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <input type="email" id="patEmail" class="form-input">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Known Allergies</label>
          <textarea id="patAllergies" class="form-input" rows="2" placeholder="e.g., Penicillin, Peanuts"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Current Medications</label>
          <textarea id="patCurrentMeds" class="form-input" rows="2" placeholder="e.g., Aspirin 75mg daily"></textarea>
        </div>
        <div class="flex gap-3 mt-6">
          <button type="submit" class="btn btn-success flex-1">Save Patient</button>
          <button type="button" onclick="closeModal('patientModal')" class="btn btn-outline">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // DRUG DATABASE
    const DRUG_DATABASE = {
      'amoxicillin': { category: 'Antibiotic', interacts: ['warfarin', 'methotrexate'], severity: 'moderate' },
      'azithromycin': { category: 'Antibiotic', interacts: ['warfarin', 'digoxin'], severity: 'moderate' },
      'aspirin': { category: 'Antiplatelet', interacts: ['warfarin', 'ibuprofen', 'naproxen'], severity: 'severe' },
      'warfarin': { category: 'Anticoagulant', interacts: ['aspirin', 'ibuprofen', 'amoxicillin'], severity: 'severe' },
      'metformin': { category: 'Antidiabetic', interacts: ['alcohol'], severity: 'severe' },
      'ibuprofen': { category: 'NSAID', interacts: ['aspirin', 'warfarin', 'lisinopril'], severity: 'moderate' },
      'amlodipine': { category: 'Calcium Channel Blocker', interacts: ['simvastatin'], severity: 'moderate' },
      'lisinopril': { category: 'ACE Inhibitor', interacts: ['potassium', 'ibuprofen'], severity: 'moderate' }
    };

    const TEMPLATES = {
      fever: {
        complaint: 'Fever for 3 days with body ache',
        history: 'Patient reports high-grade fever (102¬∞F) for past 3 days, associated with body ache, headache, and mild cough. No breathlessness.',
        diagnosis: 'Viral Fever',
        treatment: `Tab Paracetamol 650mg - TDS - 5 days (after meals)
Tab Cetirizine 10mg - OD - 5 days (at bedtime)

Advice:
- Rest and adequate hydration (3-4L water/day)
- Avoid cold foods
- Monitor temperature`,
        followupNotes: 'Review if fever persists >3 days'
      },
      cold: {
        complaint: 'Cold and cough for 2 days',
        history: 'Patient has runny nose, sneezing, and dry cough for 2 days. No fever. Mild throat irritation.',
        diagnosis: 'Upper Respiratory Tract Infection (URTI)',
        treatment: `Tab Cetirizine 10mg - OD - 5 days
Syrup Salbutamol 5ml - TDS - 5 days

Advice:
- Steam inhalation 2-3 times daily
- Warm water gargles
- Avoid cold drinks`,
        followupNotes: 'Review if symptoms worsen'
      },
      gastritis: {
        complaint: 'Acidity and stomach pain',
        history: 'Patient complains of burning sensation in stomach, especially after meals. Occasional nausea. No vomiting.',
        diagnosis: 'Gastritis',
        treatment: `Tab Pantoprazole 40mg - OD - 14 days (before breakfast)
Tab Domperidone 10mg - TDS - 5 days (before meals)

Advice:
- Avoid spicy and oily foods
- Small frequent meals
- No late-night meals`,
        followupNotes: 'Review after 2 weeks'
      },
      uti: {
        complaint: 'Burning urination',
        history: 'Patient reports burning sensation during urination for 2 days. Increased frequency. No fever.',
        diagnosis: 'Urinary Tract Infection (UTI)',
        treatment: `Tab Norfloxacin 400mg - BD - 5 days
Tab Citralka 2 tsp - TDS - 5 days (in water)

Advice:
- Drink 3-4 liters water daily
- Maintain hygiene
- Complete antibiotic course`,
        followupNotes: 'Urine culture if not improved in 3 days'
      },
      hypertension: {
        complaint: 'High blood pressure',
        history: 'Patient has elevated BP readings at home (150/95). Occasional headache. No chest pain or breathlessness.',
        diagnosis: 'Hypertension',
        treatment: `Tab Amlodipine 5mg - OD - 30 days (morning)
Tab Aspirin 75mg - OD - 30 days (after dinner)

Advice:
- Low salt diet (<5g/day)
- Regular exercise (30min walking)
- Monitor BP daily
- Avoid stress`,
        followupNotes: 'Review after 1 month with BP chart'
      },
      diabetes: {
        complaint: 'High blood sugar',
        history: 'Patient reports fasting sugar 180mg/dL, PP 250mg/dL. Increased thirst and urination.',
        diagnosis: 'Diabetes Mellitus Type 2',
        treatment: `Tab Metformin 500mg - BD - 30 days (after meals)
Tab Glimepiride 1mg - OD - 30 days (before breakfast)

Advice:
- Diabetic diet (avoid sugar/sweets)
- Regular exercise
- Monitor blood sugar fasting & PP
- Foot care`,
        followupNotes: 'Review after 1 month with sugar chart'
      }
    };

    let DB = {
      patients: [
        {id: 'p1', patient_id: 'P001', first_name: 'Rajesh', last_name: 'Kumar', age: 45, gender: 'Male', blood_group: 'O+', phone: '+919876543220', allergies: 'Penicillin', current_medications: 'Aspirin 75mg'},
        {id: 'p2', patient_id: 'P002', first_name: 'Priya', last_name: 'Sharma', age: 32, gender: 'Female', blood_group: 'A+', phone: '+919876543221'},
        {id: 'p3', patient_id: 'P003', first_name: 'Kumar', last_name: 'Vaibhav', age: 28, gender: 'Male', blood_group: 'A-', phone: '09999456126'}
      ],
      examinations: []
    };

    let currentScreen = 'dashboard';
    let recognition = null;
    let currentVoiceField = null;

    // Voice Recognition Setup
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-IN';

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        if (currentVoiceField) {
          const field = document.getElementById(currentVoiceField);
          if (field.tagName === 'TEXTAREA') {
            field.value += (field.value ? '\n' : '') + transcript;
          } else {
            field.value = transcript;
          }
          if (currentVoiceField === 'vitalWeight' || currentVoiceField === 'vitalHeight') {
            calculateBMI();
          }
          if (currentVoiceField === 'examTreatment') {
            checkDrugSafety();
          }
        }
        stopVoice();
      };

      recognition.onerror = function(event) {
        stopVoice();
        if (event.error !== 'no-speech') {
          alert('Voice recognition error. Please try again.');
        }
      };

      recognition.onend = function() {
        stopVoice();
      };
    }

    window.startVoice = function(fieldId) {
      if (!recognition) {
        alert('Voice recognition not supported. Please use Chrome or Edge browser.');
        return;
      }
      
      currentVoiceField = fieldId;
      const btn = event.target;
      btn.classList.add('listening');
      recognition.start();
    };

    function stopVoice() {
      document.querySelectorAll('.mic-btn').forEach(btn => btn.classList.remove('listening'));
      currentVoiceField = null;
    }

    window.applyTemplate = function(type) {
      const template = TEMPLATES[type];
      if (template) {
        document.getElementById('examComplaint').value = template.complaint;
        document.getElementById('examHistory').value = template.history;
        document.getElementById('examDiagnosis').value = template.diagnosis;
        document.getElementById('examTreatment').value = template.treatment;
        document.getElementById('examFollowupNotes').value = template.followupNotes;
        checkDrugSafety();
        alert(`‚úÖ ${type.charAt(0).toUpperCase() + type.slice(1)} template applied!`);
      }
    };

    window.calculateBMI = function() {
      const weight = parseFloat(document.getElementById('vitalWeight').value);
      const height = parseFloat(document.getElementById('vitalHeight').value);
      
      if (weight && height) {
        const heightM = height / 100;
        const bmi = (weight / (heightM * heightM)).toFixed(1);
        
        let category = '';
        let color = '';
        if (bmi < 18.5) { category = 'Underweight'; color = '#F39C12'; }
        else if (bmi < 25) { category = 'Normal'; color = '#3AAA35'; }
        else if (bmi < 30) { category = 'Overweight'; color = '#F39C12'; }
        else { category = 'Obese'; color = '#E74C3C'; }
        
        document.getElementById('bmiDisplay').innerHTML = `
          <div class="bmi-display">
            <strong style="font-size: 16px;">BMI: ${bmi}</strong>
            <span style="margin-left: 12px; color: ${color}; font-weight: 600;">Category: ${category}</span>
          </div>
        `;
        document.getElementById('bmiDisplay').style.display = 'block';
      }
    };

    window.checkDrugSafety = function() {
      const patientId = document.getElementById('examPatient')?.value;
      if (!patientId) return;
      
      const patient = DB.patients.find(p => p.id === patientId);
      const treatment = document.getElementById('examTreatment')?.value?.toLowerCase() || '';
      
      let alerts = [];
      
      if (patient.allergies) {
        const allergies = patient.allergies.toLowerCase().split(',').map(a => a.trim());
        allergies.forEach(allergy => {
          if (treatment.includes(allergy)) {
            alerts.push({
              type: 'danger',
              title: 'üö® ALLERGY ALERT',
              message: `Patient is allergic to ${allergy.toUpperCase()}!`
            });
          }
        });
      }
      
      if (patient.current_medications) {
        const currentMeds = patient.current_medications.toLowerCase().split(',').map(m => m.trim());
        
        Object.keys(DRUG_DATABASE).forEach(drug => {
          if (treatment.includes(drug)) {
            const drugInfo = DRUG_DATABASE[drug];
            
            drugInfo.interacts.forEach(interactingDrug => {
              const isOnCurrentMed = currentMeds.some(med => med.includes(interactingDrug));
              const isInNewTreatment = treatment.includes(interactingDrug);
              
              if (isOnCurrentMed || isInNewTreatment) {
                const severity = drugInfo.severity;
                const alertType = severity === 'severe' ? 'danger' : severity === 'moderate' ? 'warning' : 'info';
                
                alerts.push({
                  type: alertType,
                  title: `‚ö†Ô∏è DRUG INTERACTION (${severity.toUpperCase()})`,
                  message: `${drug.toUpperCase()} interacts with ${interactingDrug.toUpperCase()}`
                });
              }
            });
          }
        });
      }
      
      const alertsDiv = document.getElementById('safetyAlerts');
      if (alertsDiv) {
        if (alerts.length > 0) {
          alertsDiv.innerHTML = alerts.map(alert => `
            <div class="alert alert-${alert.type}">
              <strong>${alert.title}</strong><br>
              ${alert.message}
            </div>
          `).join('');
        } else {
          alertsDiv.innerHTML = '';
        }
      }
    };

    window.openModal = function(id) {
      document.getElementById(id).classList.add('active');
      if (id === 'examModal') {
        const select = document.getElementById('examPatient');
        select.innerHTML = DB.patients.map(p => `<option value="${p.id}">${p.patient_id} - ${p.first_name} ${p.last_name}</option>`).join('');
        checkDrugSafety();
      }
    };

    window.closeModal = function(id) {
      document.getElementById(id).classList.remove('active');
    };

    window.switchScreen = function(screen) {
      currentScreen = screen;
      render();
    };

    window.savePatient = function(e) {
      e.preventDefault();
      const p = {
        id: 'p' + Date.now(),
        patient_id: 'P' + String(DB.patients.length + 1).padStart(3, '0'),
        first_name: document.getElementById('patFirstName').value,
        last_name: document.getElementById('patLastName').value,
        age: parseInt(document.getElementById('patAge').value),
        gender: document.getElementById('patGender').value,
        blood_group: document.getElementById('patBlood').value,
        phone: document.getElementById('patPhone').value,
        email: document.getElementById('patEmail').value,
        allergies: document.getElementById('patAllergies').value,
        current_medications: document.getElementById('patCurrentMeds').value
      };
      DB.patients.push(p);
      localStorage.setItem('patients', JSON.stringify(DB.patients));
      closeModal('patientModal');
      alert('‚úÖ Patient registered successfully!');
      render();
    };

    window.saveExam = function(e) {
      e.preventDefault();
      const exam = {
        id: 'e' + Date.now(),
        patient_id: document.getElementById('examPatient').value,
        date: new Date().toISOString().split('T')[0],
        vitals: {
          bp: document.getElementById('vitalBP').value,
          temp: document.getElementById('vitalTemp').value,
          pulse: document.getElementById('vitalPulse').value,
          spo2: document.getElementById('vitalSpO2').value,
          weight: document.getElementById('vitalWeight').value,
          height: document.getElementById('vitalHeight').value,
          bmi: document.getElementById('bmiDisplay').textContent
        },
        chief_complaint: document.getElementById('examComplaint').value,
        history: document.getElementById('examHistory').value,
        diagnosis: document.getElementById('examDiagnosis').value,
        treatment_plan: document.getElementById('examTreatment').value,
        followup_date: document.getElementById('examFollowup').value,
        followup_notes: document.getElementById('examFollowupNotes').value
      };
      DB.examinations.push(exam);
      localStorage.setItem('examinations', JSON.stringify(DB.examinations));
      closeModal('examModal');
      alert('‚úÖ Examination saved successfully!');
      render();
    };

    window.generatePDF = function() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const patientId = document.getElementById('examPatient').value;
      const patient = DB.patients.find(p => p.id === patientId);
      if (!patient) { alert('Select patient first'); return; }

      doc.setFillColor(20, 190, 240);
      doc.rect(0, 0, 210, 45, 'F');
      doc.setFillColor(255, 255, 255);
      doc.circle(25, 22, 12, 'F');
      doc.setFillColor(20, 190, 240);
      doc.setFontSize(16);
      doc.setFont(undefined, 'bold');
      doc.text('M', 25, 26, { align: 'center' });
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(26);
      doc.text('MediScript Pro', 45, 20);
      doc.setFontSize(11);
      doc.setFont(undefined, 'normal');
      doc.text('AI-Powered Healthcare Platform', 45, 28);

      doc.setFillColor(246, 248, 250);
      doc.rect(15, 55, 180, 25, 'F');
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(11);
      doc.setFont(undefined, 'bold');
      doc.text('Patient Information', 20, 62);
      doc.setFont(undefined, 'normal');
      doc.setFontSize(10);
      doc.text(`Name: ${patient.first_name} ${patient.last_name}`, 20, 70);
      doc.text(`Age/Gender: ${patient.age}Y / ${patient.gender}`, 20, 76);
      doc.text(`Patient ID: ${patient.patient_id}`, 120, 70);
      doc.text(`Date: ${new Date().toLocaleDateString()}`, 120, 76);

      doc.setFontSize(11);
      doc.setFont(undefined, 'bold');
      doc.text('Diagnosis:', 20, 92);
      doc.setFont(undefined, 'normal');
      doc.setFontSize(10);
      doc.text(document.getElementById('examDiagnosis').value, 20, 100);

      doc.setFont(undefined, 'bold');
      doc.setFontSize(11);
      doc.text('Treatment Plan:', 20, 115);
      doc.setFont(undefined, 'normal');
      doc.setFontSize(10);
      const treatment = doc.splitTextToSize(document.getElementById('examTreatment').value || 'Not specified', 170);
      doc.text(treatment, 20, 123);

      doc.save(`Prescription_${patient.patient_id}_${new Date().toISOString().split('T')[0]}.pdf`);
      alert('‚úÖ PDF generated!');
    };

    function render() {
      const app = document.getElementById('app');
      
      const header = `<div class="header">
        <div class="logo">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <rect width="32" height="32" rx="8" fill="#14BEF0"/>
            <path d="M16 8L16 24M8 16L24 16" stroke="white" stroke-width="3" stroke-linecap="round"/>
          </svg>
          <span>MediScript Pro</span>
        </div>
        <div class="flex items-center gap-4">
          <div class="text-right">
            <div style="font-weight: 600; font-size: 14px; color: var(--text-dark);">Dr. Rajesh Sharma</div>
            <div style="font-size: 12px; color: var(--text-light);">MBBS, MD - General Medicine</div>
          </div>
          <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700;">RS</div>
        </div>
      </div>`;

      const sidebar = `<div class="sidebar">
        <div class="nav-item ${currentScreen === 'dashboard' ? 'active' : ''}" onclick="switchScreen('dashboard')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
          <span>Dashboard</span>
        </div>
        <div class="nav-item ${currentScreen === 'patients' ? 'active' : ''}" onclick="switchScreen('patients')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
          <span>Patients</span>
        </div>
        <div class="nav-item ${currentScreen === 'examinations' ? 'active' : ''}" onclick="switchScreen('examinations')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          <span>Examinations</span>
        </div>
      </div>`;

      let content = '';

      if (currentScreen === 'dashboard') {
        content = `
          <div style="padding: 32px;">
            <div style="margin-bottom: 24px;">
              <h1 class="page-title">Dashboard</h1>
              <p class="page-subtitle">Voice-Enabled Healthcare Platform</p>
            </div>
            
            <div class="grid grid-cols-3 gap-6 mb-8">
              <div class="stat-card" onclick="switchScreen('patients')">
                <div class="stat-label">Total Patients</div>
                <div class="stat-number">${DB.patients.length}</div>
              </div>
              <div class="stat-card" onclick="switchScreen('examinations')">
                <div class="stat-label">Examinations</div>
                <div class="stat-number">${DB.examinations.length}</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Voice Enabled</div>
                <div class="stat-number">‚úÖ</div>
              </div>
            </div>

            <div class="card">
              <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 20px;">Quick Actions</h3>
              <div class="grid grid-cols-2 gap-4">
                <button onclick="openModal('patientModal')" class="btn btn-success" style="justify-content: center; padding: 20px;">
                  <span style="font-size: 24px;">üë§</span>
                  <span>Register New Patient</span>
                </button>
                <button onclick="openModal('examModal')" class="btn btn-primary" style="justify-content: center; padding: 20px;">
                  <span style="font-size: 24px;">ü©∫</span>
                  <span>New Examination (Voice Enabled)</span>
                </button>
              </div>
            </div>
          </div>
        `;
      } else if (currentScreen === 'patients') {
        content = `
          <div style="padding: 32px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <div>
                <h1 class="page-title">Patients</h1>
                <p class="page-subtitle">Manage all registered patients</p>
              </div>
              <button onclick="openModal('patientModal')" class="btn btn-primary">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                Register Patient
              </button>
            </div>

            <div class="card">
              <table>
                <thead>
                  <tr>
                    <th>Patient ID</th>
                    <th>Name</th>
                    <th>Age</th>
                    <th>Gender</th>
                    <th>Blood Group</th>
                    <th>Contact</th>
                  </tr>
                </thead>
                <tbody>
                  ${DB.patients.map(p => `
                    <tr>
                      <td><span class="badge badge-primary">${p.patient_id}</span></td>
                      <td style="font-weight: 600;">${p.first_name} ${p.last_name}</td>
                      <td>${p.age} years</td>
                      <td>${p.gender}</td>
                      <td><span class="badge badge-danger">${p.blood_group}</span></td>
                      <td style="font-size: 13px;">${p.phone}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else if (currentScreen === 'examinations') {
        content = `
          <div style="padding: 32px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <div>
                <h1 class="page-title">Examinations</h1>
                <p class="page-subtitle">View and manage patient examinations</p>
              </div>
              <button onclick="openModal('examModal')" class="btn btn-primary">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                New Examination
              </button>
            </div>

            <div class="card">
              ${DB.examinations.length === 0 ? `
                <div style="text-align: center; padding: 60px 20px;">
                  <div style="font-size: 64px; margin-bottom: 16px; opacity: 0.3;">ü©∫</div>
                  <div style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">No examinations yet</div>
                  <div style="font-size: 14px; color: var(--text-light); margin-bottom: 24px;">Start by creating your first patient examination</div>
                  <button onclick="openModal('examModal')" class="btn btn-primary">Create Examination</button>
                </div>
              ` : `
                <table>
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Patient</th>
                      <th>Chief Complaint</th>
                      <th>Diagnosis</th>
                      <th>Vitals</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${DB.examinations.map(e => {
                      const p = DB.patients.find(pt => pt.id === e.patient_id);
                      return `
                        <tr>
                          <td>${e.date}</td>
                          <td style="font-weight: 600;">${p.first_name} ${p.last_name}</td>
                          <td style="font-size: 13px;">${e.chief_complaint}</td>
                          <td><span class="badge badge-success">${e.diagnosis}</span></td>
                          <td style="font-size: 13px;">BP: ${e.vitals.bp || 'N/A'}</td>
                        </tr>
                      `;
                    }).join('')}
                  </tbody>
                </table>
              `}
            </div>
          </div>
        `;
      }

      app.innerHTML = `${header}<div style="display: flex;">${sidebar}<div style="flex: 1; background: #F8F9FA; min-height: calc(100vh - 65px);">${content}</div></div>`;
    }

    const savedPatients = localStorage.getItem('patients');
    const savedExams = localStorage.getItem('examinations');
    if (savedPatients) DB.patients = JSON.parse(savedPatients);
    if (savedExams) DB.examinations = JSON.parse(savedExams);

    render();
    console.log('‚úÖ MediScript Pro - Voice-Enabled Examination Ready!');
  </script>
</body>
</html>