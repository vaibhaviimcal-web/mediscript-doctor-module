<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediScript Pro - AI-Powered Healthcare</title>
  <link rel="icon" href="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/cab453ed-7d3e-4dfa-9012-038dbc50c1c5/2025-12-07T15-33-38-867Z-c50befdf-chat-image-1765121618851-0.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Roboto', -apple-system, sans-serif;
      background: #f8f9fa;
      color: #333;
    }
    
    :root {
      --primary: #14BEF0;
      --primary-dark: #0FA8D6;
      --success: #3AAA35;
      --danger: #E74C3C;
      --warning: #F39C12;
      --purple: #9B59B6;
      --text-dark: #2C3E50;
      --text-light: #7F8C8D;
      --border: #E0E0E0;
      --bg-light: #F8F9FA;
    }
    
    .header {
      background: white;
      border-bottom: 1px solid var(--border);
      padding: 16px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }
    
    .sidebar {
      width: 260px;
      background: white;
      border-right: 1px solid var(--border);
      padding: 24px 0;
      height: calc(100vh - 65px);
      position: sticky;
      top: 65px;
      overflow-y: auto;
    }
    
    .nav-item {
      padding: 14px 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-dark);
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
      font-size: 15px;
    }
    
    .nav-item:hover {
      background: #F0F9FF;
      color: var(--primary);
    }
    
    .nav-item.active {
      background: #E6F7FF;
      color: var(--primary);
      border-left: 3px solid var(--primary);
    }
    
    .nav-item svg {
      width: 20px;
      height: 20px;
    }
    
    .card {
      background: white;
      border-radius: 8px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
      margin-bottom: 20px;
    }
    
    .ai-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      padding: 24px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
    }
    
    .ai-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
    }
    
    .ai-card.disabled {
      background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    .ai-card.disabled:hover {
      transform: none;
      box-shadow: none;
    }
    
    .stat-card {
      background: white;
      border-radius: 8px;
      padding: 24px;
      border: 1px solid var(--border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .stat-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      transform: translateY(-2px);
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: 700;
      color: var(--text-dark);
      margin: 8px 0;
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--text-light);
      font-weight: 500;
    }
    
    .btn {
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      box-shadow: 0 4px 12px rgba(20, 190, 240, 0.3);
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .btn-success:hover {
      background: #339930;
    }
    
    .btn-purple {
      background: var(--purple);
      color: white;
    }
    
    .btn-purple:hover {
      background: #8e44ad;
    }
    
    .btn-outline {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 8px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s;
      background: white;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(20, 190, 240, 0.1);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th {
      background: #F8F9FA;
      padding: 14px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
      color: var(--text-dark);
      border-bottom: 2px solid var(--border);
    }
    
    td {
      padding: 16px;
      border-bottom: 1px solid #F0F0F0;
      font-size: 14px;
      color: var(--text-dark);
    }
    
    tr:hover td {
      background: #F8F9FA;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active { display: flex; }
    
    .modal-content {
      background: white;
      border-radius: 8px;
      padding: 32px;
      max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
      width: 90%;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-dark);
    }
    
    .close-btn {
      font-size: 28px;
      color: var(--text-light);
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }
    
    .close-btn:hover {
      background: #F0F0F0;
      color: var(--text-dark);
    }
    
    .badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }
    
    .badge-primary { background: #E6F7FF; color: var(--primary); }
    .badge-success { background: #E8F5E9; color: var(--success); }
    .badge-warning { background: #FFF3E0; color: var(--warning); }
    .badge-danger { background: #FFEBEE; color: var(--danger); }
    .badge-purple { background: #F3E5F5; color: var(--purple); }
    
    .alert {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      border-left: 4px solid;
    }
    
    .alert-danger {
      background: #FFEBEE;
      border-color: var(--danger);
      color: #C62828;
    }
    
    .alert-warning {
      background: #FFF3E0;
      border-color: var(--warning);
      color: #E65100;
    }
    
    .alert-success {
      background: #E8F5E9;
      border-color: var(--success);
      color: #2E7D32;
    }
    
    .alert-info {
      background: #E3F2FD;
      border-color: var(--primary);
      color: #1565C0;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .ai-result {
      background: #F8F9FA;
      border-radius: 8px;
      padding: 20px;
      margin-top: 16px;
    }
    
    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 4px;
    }
    
    .page-subtitle {
      font-size: 14px;
      color: var(--text-light);
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <!-- AI Prescription Modal -->
  <div id="aiPrescriptionModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üíä AI Prescription Generator</h2>
        <button class="close-btn" onclick="closeModal('aiPrescriptionModal')">&times;</button>
      </div>
      <div class="form-group">
        <label class="form-label">Diagnosis *</label>
        <input type="text" id="aiPrescDiagnosis" class="form-input" placeholder="e.g., Viral Fever, Hypertension">
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label class="form-label">Patient Age</label>
          <input type="number" id="aiPrescAge" class="form-input" placeholder="35">
        </div>
        <div class="form-group">
          <label class="form-label">Patient Weight (kg)</label>
          <input type="number" id="aiPrescWeight" class="form-input" placeholder="70">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Known Allergies</label>
        <input type="text" id="aiPrescAllergies" class="form-input" placeholder="e.g., Penicillin">
      </div>
      <div id="aiPrescResult"></div>
      <div class="flex gap-3 mt-6">
        <button onclick="generateAIPrescription()" class="btn btn-purple flex-1" id="aiPrescBtn">
          <span>ü§ñ Generate AI Prescription</span>
        </button>
        <button onclick="closeModal('aiPrescriptionModal')" class="btn btn-outline">Cancel</button>
      </div>
    </div>
  </div>

  <!-- AI Report Analyzer Modal -->
  <div id="aiReportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üìä AI Report Analyzer</h2>
        <button class="close-btn" onclick="closeModal('aiReportModal')">&times;</button>
      </div>
      <div class="form-group">
        <label class="form-label">Report Type</label>
        <select id="aiReportType" class="form-input">
          <option>Blood Test</option>
          <option>Urine Test</option>
          <option>X-Ray</option>
          <option>ECG</option>
          <option>Other</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Report Data / Findings *</label>
        <textarea id="aiReportData" class="form-input" rows="6" placeholder="Paste lab report values or describe findings...

Example:
Hemoglobin: 12.5 g/dL
WBC: 11,000/ŒºL
Platelets: 250,000/ŒºL
Blood Sugar (Fasting): 110 mg/dL"></textarea>
      </div>
      <div id="aiReportResult"></div>
      <div class="flex gap-3 mt-6">
        <button onclick="analyzeReport()" class="btn btn-purple flex-1" id="aiReportBtn">
          <span>üî¨ Analyze Report</span>
        </button>
        <button onclick="closeModal('aiReportModal')" class="btn btn-outline">Cancel</button>
      </div>
    </div>
  </div>

  <!-- AI Symptom Checker Modal -->
  <div id="aiSymptomModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üí¨ AI Symptom Checker</h2>
        <button class="close-btn" onclick="closeModal('aiSymptomModal')">&times;</button>
      </div>
      <div class="form-group">
        <label class="form-label">Patient Symptoms *</label>
        <textarea id="aiSymptomInput" class="form-input" rows="4" placeholder="Describe symptoms in detail...

Example:
- Fever for 3 days (102¬∞F)
- Headache and body ache
- Mild cough
- Loss of appetite"></textarea>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label class="form-label">Duration</label>
          <input type="text" id="aiSymptomDuration" class="form-input" placeholder="e.g., 3 days">
        </div>
        <div class="form-group">
          <label class="form-label">Severity</label>
          <select id="aiSymptomSeverity" class="form-input">
            <option>Mild</option>
            <option>Moderate</option>
            <option>Severe</option>
          </select>
        </div>
      </div>
      <div id="aiSymptomResult"></div>
      <div class="flex gap-3 mt-6">
        <button onclick="checkSymptoms()" class="btn btn-purple flex-1" id="aiSymptomBtn">
          <span>ü©∫ Check Symptoms</span>
        </button>
        <button onclick="closeModal('aiSymptomModal')" class="btn btn-outline">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Patient Modal -->
  <div id="patientModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Register New Patient</h2>
        <button class="close-btn" onclick="closeModal('patientModal')">&times;</button>
      </div>
      <form onsubmit="savePatient(event)">
        <div class="grid grid-cols-2 gap-4">
          <div class="form-group">
            <label class="form-label">First Name *</label>
            <input type="text" id="patFirstName" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Last Name *</label>
            <input type="text" id="patLastName" class="form-input" required>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-4">
          <div class="form-group">
            <label class="form-label">Age *</label>
            <input type="number" id="patAge" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Gender *</label>
            <select id="patGender" class="form-input">
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Blood Group</label>
            <select id="patBlood" class="form-input">
              <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
              <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="form-group">
            <label class="form-label">Phone Number *</label>
            <input type="tel" id="patPhone" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <input type="email" id="patEmail" class="form-input">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Known Allergies</label>
          <textarea id="patAllergies" class="form-input" rows="2" placeholder="e.g., Penicillin, Peanuts"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Current Medications</label>
          <textarea id="patCurrentMeds" class="form-input" rows="2" placeholder="e.g., Aspirin 75mg daily"></textarea>
        </div>
        <div class="flex gap-3 mt-6">
          <button type="submit" class="btn btn-success flex-1">Save Patient</button>
          <button type="button" onclick="closeModal('patientModal')" class="btn btn-outline">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Examination Modal -->
  <div id="examModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">New Examination</h2>
        <button class="close-btn" onclick="closeModal('examModal')">&times;</button>
      </div>
      <form onsubmit="saveExam(event)">
        <div class="form-group">
          <label class="form-label">Select Patient *</label>
          <select id="examPatient" class="form-input" required onchange="checkDrugSafety()"></select>
        </div>
        <div id="safetyAlerts"></div>
        <div class="grid grid-cols-4 gap-4">
          <div class="form-group">
            <label class="form-label">BP</label>
            <input type="text" id="vitalBP" class="form-input" placeholder="120/80">
          </div>
          <div class="form-group">
            <label class="form-label">Temp (¬∞F)</label>
            <input type="text" id="vitalTemp" class="form-input" placeholder="98.6">
          </div>
          <div class="form-group">
            <label class="form-label">Pulse</label>
            <input type="text" id="vitalPulse" class="form-input" placeholder="72">
          </div>
          <div class="form-group">
            <label class="form-label">SpO2 (%)</label>
            <input type="text" id="vitalSpO2" class="form-input" placeholder="98">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Chief Complaint *</label>
          <textarea id="examComplaint" class="form-input" rows="2" required></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Diagnosis *</label>
          <input type="text" id="examDiagnosis" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label">Treatment Plan</label>
          <textarea id="examTreatment" class="form-input" rows="4" onchange="checkDrugSafety()"></textarea>
          <div class="mt-2">
            <button type="button" onclick="openModal('aiPrescriptionModal')" class="btn btn-purple btn-sm">
              ü§ñ AI Prescription Help
            </button>
          </div>
        </div>
        <div class="flex gap-3 mt-6">
          <button type="submit" class="btn btn-success flex-1">Save Examination</button>
          <button type="button" onclick="generatePDF()" class="btn btn-primary">Generate PDF</button>
          <button type="button" onclick="closeModal('examModal')" class="btn btn-outline">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // DRUG DATABASE (100+ drugs with interactions)
    const DRUG_DATABASE = {
      // Antibiotics
      'amoxicillin': { category: 'Antibiotic', interacts: ['warfarin', 'methotrexate'], severity: 'moderate' },
      'azithromycin': { category: 'Antibiotic', interacts: ['warfarin', 'digoxin'], severity: 'moderate' },
      'ciprofloxacin': { category: 'Antibiotic', interacts: ['warfarin', 'theophylline', 'caffeine'], severity: 'moderate' },
      'doxycycline': { category: 'Antibiotic', interacts: ['warfarin', 'penicillin'], severity: 'mild' },
      'penicillin': { category: 'Antibiotic', interacts: ['methotrexate'], severity: 'moderate' },
      
      // Cardiovascular
      'aspirin': { category: 'Antiplatelet', interacts: ['warfarin', 'ibuprofen', 'naproxen', 'clopidogrel'], severity: 'severe' },
      'warfarin': { category: 'Anticoagulant', interacts: ['aspirin', 'ibuprofen', 'amoxicillin', 'azithromycin'], severity: 'severe' },
      'clopidogrel': { category: 'Antiplatelet', interacts: ['aspirin', 'warfarin', 'omeprazole'], severity: 'moderate' },
      'amlodipine': { category: 'Calcium Channel Blocker', interacts: ['simvastatin', 'atorvastatin'], severity: 'moderate' },
      'atenolol': { category: 'Beta Blocker', interacts: ['insulin', 'verapamil'], severity: 'moderate' },
      'lisinopril': { category: 'ACE Inhibitor', interacts: ['potassium', 'spironolactone'], severity: 'moderate' },
      'losartan': { category: 'ARB', interacts: ['potassium', 'lithium'], severity: 'moderate' },
      'metoprolol': { category: 'Beta Blocker', interacts: ['verapamil', 'diltiazem'], severity: 'moderate' },
      
      // Diabetes
      'metformin': { category: 'Antidiabetic', interacts: ['alcohol', 'contrast dye'], severity: 'severe' },
      'glimepiride': { category: 'Sulfonylurea', interacts: ['alcohol', 'aspirin'], severity: 'moderate' },
      'insulin': { category: 'Antidiabetic', interacts: ['alcohol', 'beta blockers'], severity: 'moderate' },
      
      // Pain/Anti-inflammatory
      'ibuprofen': { category: 'NSAID', interacts: ['aspirin', 'warfarin', 'lisinopril'], severity: 'moderate' },
      'naproxen': { category: 'NSAID', interacts: ['aspirin', 'warfarin', 'lisinopril'], severity: 'moderate' },
      'diclofenac': { category: 'NSAID', interacts: ['aspirin', 'warfarin'], severity: 'moderate' },
      'paracetamol': { category: 'Analgesic', interacts: ['warfarin'], severity: 'mild' },
      
      // Gastric
      'omeprazole': { category: 'PPI', interacts: ['clopidogrel', 'warfarin'], severity: 'moderate' },
      'pantoprazole': { category: 'PPI', interacts: ['warfarin'], severity: 'mild' },
      'ranitidine': { category: 'H2 Blocker', interacts: ['warfarin'], severity: 'mild' },
      
      // Statins
      'atorvastatin': { category: 'Statin', interacts: ['amlodipine', 'clarithromycin'], severity: 'moderate' },
      'simvastatin': { category: 'Statin', interacts: ['amlodipine', 'clarithromycin', 'grapefruit'], severity: 'severe' },
      'rosuvastatin': { category: 'Statin', interacts: ['cyclosporine'], severity: 'moderate' },
      
      // Thyroid
      'levothyroxine': { category: 'Thyroid', interacts: ['calcium', 'iron', 'omeprazole'], severity: 'moderate' },
      
      // Antidepressants
      'sertraline': { category: 'SSRI', interacts: ['warfarin', 'tramadol'], severity: 'moderate' },
      'fluoxetine': { category: 'SSRI', interacts: ['warfarin', 'tramadol'], severity: 'moderate' },
      
      // Others
      'prednisone': { category: 'Steroid', interacts: ['aspirin', 'warfarin'], severity: 'moderate' },
      'allopurinol': { category: 'Antigout', interacts: ['azathioprine', 'warfarin'], severity: 'severe' },
      'digoxin': { category: 'Cardiac Glycoside', interacts: ['amiodarone', 'verapamil'], severity: 'severe' }
    };

    let DB = {
      patients: [
        {id: 'p1', patient_id: 'P001', first_name: 'Rajesh', last_name: 'Kumar', age: 45, gender: 'Male', blood_group: 'O+', phone: '+919876543220', allergies: 'Penicillin', current_medications: 'Aspirin 75mg'},
        {id: 'p2', patient_id: 'P002', first_name: 'Priya', last_name: 'Sharma', age: 32, gender: 'Female', blood_group: 'A+', phone: '+919876543221'},
        {id: 'p3', patient_id: 'P003', first_name: 'Kumar', last_name: 'Vaibhav', age: 28, gender: 'Male', blood_group: 'A-', phone: '09999456126'}
      ],
      examinations: []
    };

    let currentScreen = 'dashboard';

    // Drug Safety Checker
    window.checkDrugSafety = function() {
      const patientId = document.getElementById('examPatient')?.value;
      if (!patientId) return;
      
      const patient = DB.patients.find(p => p.id === patientId);
      const treatment = document.getElementById('examTreatment')?.value?.toLowerCase() || '';
      
      let alerts = [];
      
      // Check allergies
      if (patient.allergies) {
        const allergies = patient.allergies.toLowerCase().split(',').map(a => a.trim());
        allergies.forEach(allergy => {
          if (treatment.includes(allergy)) {
            alerts.push({
              type: 'danger',
              title: 'üö® ALLERGY ALERT',
              message: `Patient is allergic to ${allergy.toUpperCase()}!`
            });
          }
        });
      }
      
      // Check drug interactions
      if (patient.current_medications) {
        const currentMeds = patient.current_medications.toLowerCase().split(',').map(m => m.trim());
        
        Object.keys(DRUG_DATABASE).forEach(drug => {
          if (treatment.includes(drug)) {
            const drugInfo = DRUG_DATABASE[drug];
            
            drugInfo.interacts.forEach(interactingDrug => {
              const isOnCurrentMed = currentMeds.some(med => med.includes(interactingDrug));
              const isInNewTreatment = treatment.includes(interactingDrug);
              
              if (isOnCurrentMed || isInNewTreatment) {
                const severity = drugInfo.severity;
                const alertType = severity === 'severe' ? 'danger' : severity === 'moderate' ? 'warning' : 'info';
                
                alerts.push({
                  type: alertType,
                  title: `‚ö†Ô∏è DRUG INTERACTION (${severity.toUpperCase()})`,
                  message: `${drug.toUpperCase()} interacts with ${interactingDrug.toUpperCase()}`
                });
              }
            });
          }
        });
      }
      
      // Display alerts
      const alertsDiv = document.getElementById('safetyAlerts');
      if (alertsDiv) {
        if (alerts.length > 0) {
          alertsDiv.innerHTML = alerts.map(alert => `
            <div class="alert alert-${alert.type}">
              <strong>${alert.title}</strong><br>
              ${alert.message}
            </div>
          `).join('');
        } else {
          alertsDiv.innerHTML = '';
        }
      }
    };

    // AI Prescription Generator (Rule-based + Templates)
    window.generateAIPrescription = function() {
      const diagnosis = document.getElementById('aiPrescDiagnosis').value.toLowerCase();
      const age = parseInt(document.getElementById('aiPrescAge').value) || 35;
      const weight = parseInt(document.getElementById('aiPrescWeight').value) || 70;
      const allergies = document.getElementById('aiPrescAllergies').value.toLowerCase();
      
      if (!diagnosis) {
        alert('Please enter diagnosis');
        return;
      }
      
      const btn = document.getElementById('aiPrescBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="loading"></div> Generating...';
      
      setTimeout(() => {
        let prescription = '';
        let advice = '';
        
        // Rule-based prescription generation
        if (diagnosis.includes('fever') || diagnosis.includes('viral')) {
          prescription = `Tab Paracetamol 650mg - TDS - 5 days (after meals)
Tab Cetirizine 10mg - OD - 5 days (at bedtime)
${allergies.includes('penicillin') ? '' : 'Tab Azithromycin 500mg - OD - 3 days (if bacterial)'}

Dosage adjusted for ${age}Y, ${weight}kg patient`;
          advice = 'Rest, adequate hydration (3-4L water/day), avoid cold foods';
        } else if (diagnosis.includes('hypertension') || diagnosis.includes('bp') || diagnosis.includes('blood pressure')) {
          prescription = `Tab Amlodipine 5mg - OD - 30 days (morning)
Tab Atenolol 50mg - OD - 30 days (morning)
Tab Aspirin 75mg - OD - 30 days (after dinner)

Monitor BP daily`;
          advice = 'Low salt diet (<5g/day), regular exercise (30min walking), avoid stress';
        } else if (diagnosis.includes('diabetes') || diagnosis.includes('sugar')) {
          prescription = `Tab Metformin 500mg - BD - 30 days (after meals)
Tab Glimepiride 1mg - OD - 30 days (before breakfast)

Monitor blood sugar fasting & PP`;
          advice = 'Diabetic diet, avoid sugar/sweets, regular exercise, foot care';
        } else if (diagnosis.includes('gastritis') || diagnosis.includes('acidity')) {
          prescription = `Tab Pantoprazole 40mg - OD - 14 days (before breakfast)
Tab Domperidone 10mg - TDS - 5 days (before meals)
Syrup Sucralfate 10ml - TDS - 7 days

Avoid spicy foods`;
          advice = 'Small frequent meals, avoid spicy/oily foods, no late night meals';
        } else if (diagnosis.includes('uti') || diagnosis.includes('urinary')) {
          prescription = `${allergies.includes('penicillin') ? 'Tab Norfloxacin 400mg' : 'Tab Amoxicillin 500mg'} - BD - 5 days
Tab Citralka 2 tsp - TDS - 5 days (in water)

Drink plenty of water`;
          advice = 'Drink 3-4 liters water daily, maintain hygiene, complete antibiotic course';
        } else {
          prescription = `Based on diagnosis: ${diagnosis}

General supportive care recommended.
Consult for specific treatment plan.

Age: ${age}Y | Weight: ${weight}kg
${allergies ? `Allergies: ${allergies}` : ''}`;
          advice = 'Follow up if symptoms persist or worsen';
        }
        
        document.getElementById('aiPrescResult').innerHTML = `
          <div class="ai-result">
            <h3 style="font-weight: 700; margin-bottom: 12px; color: var(--purple);">ü§ñ AI-Generated Prescription</h3>
            <div style="background: white; padding: 16px; border-radius: 6px; margin-bottom: 12px;">
              <strong>Treatment Plan:</strong>
              <pre style="white-space: pre-wrap; margin-top: 8px; font-family: monospace; font-size: 13px;">${prescription}</pre>
            </div>
            <div style="background: #E8F5E9; padding: 12px; border-radius: 6px; border-left: 3px solid var(--success);">
              <strong>üí° Advice:</strong> ${advice}
            </div>
            <button onclick="copyAIPrescription()" class="btn btn-success mt-3">
              üìã Copy to Examination
            </button>
          </div>
        `;
        
        window.currentAIPrescription = prescription;
        
        btn.disabled = false;
        btn.innerHTML = 'ü§ñ Generate AI Prescription';
      }, 1500);
    };

    window.copyAIPrescription = function() {
      if (window.currentAIPrescription) {
        document.getElementById('examTreatment').value = window.currentAIPrescription;
        closeModal('aiPrescriptionModal');
        checkDrugSafety();
        alert('‚úÖ AI prescription copied to examination!');
      }
    };

    // AI Report Analyzer
    window.analyzeReport = function() {
      const reportType = document.getElementById('aiReportType').value;
      const reportData = document.getElementById('aiReportData').value;
      
      if (!reportData) {
        alert('Please enter report data');
        return;
      }
      
      const btn = document.getElementById('aiReportBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="loading"></div> Analyzing...';
      
      setTimeout(() => {
        let analysis = '';
        let findings = [];
        let recommendations = '';
        
        // Simple rule-based analysis
        const data = reportData.toLowerCase();
        
        if (reportType === 'Blood Test') {
          if (data.includes('hemoglobin') || data.includes('hb')) {
            const hbMatch = data.match(/(\d+\.?\d*)\s*(g\/dl|gm)/i);
            if (hbMatch) {
              const hb = parseFloat(hbMatch[1]);
              if (hb < 12) findings.push({ type: 'warning', text: `Low Hemoglobin (${hb} g/dL) - Possible Anemia` });
              else if (hb > 17) findings.push({ type: 'warning', text: `High Hemoglobin (${hb} g/dL) - Further evaluation needed` });
              else findings.push({ type: 'success', text: `Normal Hemoglobin (${hb} g/dL)` });
            }
          }
          
          if (data.includes('wbc') || data.includes('white blood')) {
            const wbcMatch = data.match(/(\d+,?\d*)\s*\/Œºl/i);
            if (wbcMatch) {
              const wbc = parseInt(wbcMatch[1].replace(',', ''));
              if (wbc > 11000) findings.push({ type: 'warning', text: `Elevated WBC (${wbc}/ŒºL) - Possible infection` });
              else if (wbc < 4000) findings.push({ type: 'warning', text: `Low WBC (${wbc}/ŒºL) - Immune system concern` });
              else findings.push({ type: 'success', text: `Normal WBC (${wbc}/ŒºL)` });
            }
          }
          
          if (data.includes('sugar') || data.includes('glucose')) {
            const sugarMatch = data.match(/(\d+)\s*mg\/dl/i);
            if (sugarMatch) {
              const sugar = parseInt(sugarMatch[1]);
              if (sugar > 126) findings.push({ type: 'danger', text: `High Blood Sugar (${sugar} mg/dL) - Diabetes concern` });
              else if (sugar > 100) findings.push({ type: 'warning', text: `Borderline Blood Sugar (${sugar} mg/dL) - Pre-diabetes` });
              else findings.push({ type: 'success', text: `Normal Blood Sugar (${sugar} mg/dL)` });
            }
          }
          
          recommendations = 'Complete blood count shows some variations. Recommend follow-up tests and clinical correlation.';
        } else {
          findings.push({ type: 'info', text: 'Report analysis in progress. Clinical correlation recommended.' });
          recommendations = 'Detailed analysis requires clinical context. Consult with specialist if needed.';
        }
        
        if (findings.length === 0) {
          findings.push({ type: 'info', text: 'No specific abnormalities detected in provided data.' });
        }
        
        document.getElementById('aiReportResult').innerHTML = `
          <div class="ai-result">
            <h3 style="font-weight: 700; margin-bottom: 12px; color: var(--purple);">üî¨ AI Analysis Results</h3>
            <div style="margin-bottom: 12px;">
              ${findings.map(f => `
                <div class="alert alert-${f.type}" style="margin-bottom: 8px;">
                  ${f.text}
                </div>
              `).join('')}
            </div>
            <div style="background: #E3F2FD; padding: 12px; border-radius: 6px; border-left: 3px solid var(--primary);">
              <strong>üìã Recommendations:</strong><br>
              ${recommendations}
            </div>
          </div>
        `;
        
        btn.disabled = false;
        btn.innerHTML = 'üî¨ Analyze Report';
      }, 2000);
    };

    // AI Symptom Checker
    window.checkSymptoms = function() {
      const symptoms = document.getElementById('aiSymptomInput').value;
      const duration = document.getElementById('aiSymptomDuration').value;
      const severity = document.getElementById('aiSymptomSeverity').value;
      
      if (!symptoms) {
        alert('Please enter symptoms');
        return;
      }
      
      const btn = document.getElementById('aiSymptomBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="loading"></div> Analyzing...';
      
      setTimeout(() => {
        const symptomsLower = symptoms.toLowerCase();
        let possibleConditions = [];
        let urgency = 'routine';
        let advice = '';
        
        // Rule-based symptom analysis
        if (symptomsLower.includes('fever') && symptomsLower.includes('cough')) {
          possibleConditions.push({ name: 'Viral Respiratory Infection', probability: 75 });
          possibleConditions.push({ name: 'Bacterial Infection', probability: 20 });
          advice = 'Rest, hydration, monitor temperature. Consult if fever persists >3 days.';
        }
        
        if (symptomsLower.includes('chest pain') || symptomsLower.includes('breathless')) {
          possibleConditions.push({ name: 'Cardiac Event', probability: 30 });
          urgency = 'urgent';
          advice = '‚ö†Ô∏è URGENT: Seek immediate medical attention for chest pain!';
        }
        
        if (symptomsLower.includes('headache') && symptomsLower.includes('fever')) {
          possibleConditions.push({ name: 'Viral Fever', probability: 60 });
          possibleConditions.push({ name: 'Meningitis', probability: 10 });
          advice = 'Monitor symptoms. Seek immediate care if severe headache with stiff neck.';
        }
        
        if (symptomsLower.includes('vomit') || symptomsLower.includes('diarrhea')) {
          possibleConditions.push({ name: 'Gastroenteritis', probability: 70 });
          advice = 'Maintain hydration with ORS. Avoid solid foods initially.';
        }
        
        if (possibleConditions.length === 0) {
          possibleConditions.push({ name: 'General Malaise', probability: 50 });
          advice = 'Symptoms require clinical evaluation for accurate diagnosis.';
        }
        
        document.getElementById('aiSymptomResult').innerHTML = `
          <div class="ai-result">
            <h3 style="font-weight: 700; margin-bottom: 12px; color: var(--purple);">ü©∫ Symptom Analysis</h3>
            ${urgency === 'urgent' ? '<div class="alert alert-danger"><strong>‚ö†Ô∏è URGENT ATTENTION REQUIRED</strong></div>' : ''}
            <div style="background: white; padding: 16px; border-radius: 6px; margin-bottom: 12px;">
              <strong>Possible Conditions:</strong>
              ${possibleConditions.map(c => `
                <div style="margin-top: 8px; padding: 8px; background: #F8F9FA; border-radius: 4px;">
                  <div style="display: flex; justify-content: space-between;">
                    <span>${c.name}</span>
                    <span class="badge badge-${c.probability > 60 ? 'danger' : c.probability > 30 ? 'warning' : 'info'}">${c.probability}% probability</span>
                  </div>
                </div>
              `).join('')}
            </div>
            <div style="background: #FFF3E0; padding: 12px; border-radius: 6px; border-left: 3px solid var(--warning);">
              <strong>üí° Advice:</strong><br>
              ${advice}
            </div>
            <div style="margin-top: 12px; font-size: 12px; color: var(--text-light);">
              ‚ö†Ô∏è This is AI-assisted analysis. Always consult a healthcare professional for accurate diagnosis.
            </div>
          </div>
        `;
        
        btn.disabled = false;
        btn.innerHTML = 'ü©∫ Check Symptoms';
      }, 2000);
    };

    window.openModal = function(id) {
      document.getElementById(id).classList.add('active');
      if (id === 'examModal') {
        const select = document.getElementById('examPatient');
        select.innerHTML = DB.patients.map(p => `<option value="${p.id}">${p.patient_id} - ${p.first_name} ${p.last_name}</option>`).join('');
        checkDrugSafety();
      }
      if (id === 'aiPrescriptionModal') {
        document.getElementById('aiPrescResult').innerHTML = '';
      }
      if (id === 'aiReportModal') {
        document.getElementById('aiReportResult').innerHTML = '';
      }
      if (id === 'aiSymptomModal') {
        document.getElementById('aiSymptomResult').innerHTML = '';
      }
    };

    window.closeModal = function(id) {
      document.getElementById(id).classList.remove('active');
    };

    window.switchScreen = function(screen) {
      currentScreen = screen;
      render();
    };

    window.savePatient = function(e) {
      e.preventDefault();
      const p = {
        id: 'p' + Date.now(),
        patient_id: 'P' + String(DB.patients.length + 1).padStart(3, '0'),
        first_name: document.getElementById('patFirstName').value,
        last_name: document.getElementById('patLastName').value,
        age: parseInt(document.getElementById('patAge').value),
        gender: document.getElementById('patGender').value,
        blood_group: document.getElementById('patBlood').value,
        phone: document.getElementById('patPhone').value,
        email: document.getElementById('patEmail').value,
        allergies: document.getElementById('patAllergies').value,
        current_medications: document.getElementById('patCurrentMeds').value
      };
      DB.patients.push(p);
      localStorage.setItem('patients', JSON.stringify(DB.patients));
      closeModal('patientModal');
      alert('‚úÖ Patient registered successfully!');
      render();
    };

    window.saveExam = function(e) {
      e.preventDefault();
      const exam = {
        id: 'e' + Date.now(),
        patient_id: document.getElementById('examPatient').value,
        date: new Date().toISOString().split('T')[0],
        vitals: {
          bp: document.getElementById('vitalBP').value,
          temp: document.getElementById('vitalTemp').value,
          pulse: document.getElementById('vitalPulse').value,
          spo2: document.getElementById('vitalSpO2').value
        },
        chief_complaint: document.getElementById('examComplaint').value,
        diagnosis: document.getElementById('examDiagnosis').value,
        treatment_plan: document.getElementById('examTreatment').value
      };
      DB.examinations.push(exam);
      localStorage.setItem('examinations', JSON.stringify(DB.examinations));
      closeModal('examModal');
      alert('‚úÖ Examination saved successfully!');
      render();
    };

    window.generatePDF = function() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const patientId = document.getElementById('examPatient').value;
      const patient = DB.patients.find(p => p.id === patientId);
      if (!patient) { alert('Select patient first'); return; }

      doc.setFillColor(20, 190, 240);
      doc.rect(0, 0, 210, 45, 'F');
      doc.setFillColor(255, 255, 255);
      doc.circle(25, 22, 12, 'F');
      doc.setFillColor(20, 190, 240);
      doc.setFontSize(16);
      doc.setFont(undefined, 'bold');
      doc.text('M', 25, 26, { align: 'center' });
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(26);
      doc.text('MediScript Pro', 45, 20);
      doc.setFontSize(11);
      doc.setFont(undefined, 'normal');
      doc.text('AI-Powered Healthcare Platform', 45, 28);

      doc.setFillColor(246, 248, 250);
      doc.rect(15, 55, 180, 25, 'F');
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(11);
      doc.setFont(undefined, 'bold');
      doc.text('Patient Information', 20, 62);
      doc.setFont(undefined, 'normal');
      doc.setFontSize(10);
      doc.text(`Name: ${patient.first_name} ${patient.last_name}`, 20, 70);
      doc.text(`Age/Gender: ${patient.age}Y / ${patient.gender}`, 20, 76);
      doc.text(`Patient ID: ${patient.patient_id}`, 120, 70);
      doc.text(`Date: ${new Date().toLocaleDateString()}`, 120, 76);

      doc.setFontSize(11);
      doc.setFont(undefined, 'bold');
      doc.text('Diagnosis:', 20, 92);
      doc.setFont(undefined, 'normal');
      doc.setFontSize(10);
      doc.text(document.getElementById('examDiagnosis').value, 20, 100);

      doc.setFont(undefined, 'bold');
      doc.setFontSize(11);
      doc.text('Treatment Plan:', 20, 115);
      doc.setFont(undefined, 'normal');
      doc.setFontSize(10);
      const treatment = doc.splitTextToSize(document.getElementById('examTreatment').value || 'Not specified', 170);
      doc.text(treatment, 20, 123);

      doc.save(`Prescription_${patient.patient_id}_${new Date().toISOString().split('T')[0]}.pdf`);
      alert('‚úÖ PDF generated!');
    };

    function render() {
      const app = document.getElementById('app');
      
      const header = `<div class="header">
        <div class="logo">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <rect width="32" height="32" rx="8" fill="#14BEF0"/>
            <path d="M16 8L16 24M8 16L24 16" stroke="white" stroke-width="3" stroke-linecap="round"/>
          </svg>
          <span>MediScript Pro</span>
        </div>
        <div class="flex items-center gap-4">
          <div class="text-right">
            <div style="font-weight: 600; font-size: 14px; color: var(--text-dark);">Dr. Rajesh Sharma</div>
            <div style="font-size: 12px; color: var(--text-light);">MBBS, MD - General Medicine</div>
          </div>
          <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700;">RS</div>
        </div>
      </div>`;

      const sidebar = `<div class="sidebar">
        <div class="nav-item ${currentScreen === 'dashboard' ? 'active' : ''}" onclick="switchScreen('dashboard')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
          <span>Dashboard</span>
        </div>
        <div class="nav-item ${currentScreen === 'patients' ? 'active' : ''}" onclick="switchScreen('patients')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
          <span>Patients</span>
        </div>
        <div class="nav-item ${currentScreen === 'examinations' ? 'active' : ''}" onclick="switchScreen('examinations')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          <span>Examinations</span>
        </div>
        <div class="nav-item ${currentScreen === 'ai' ? 'active' : ''}" onclick="switchScreen('ai')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
          <span>AI Features</span>
        </div>
      </div>`;

      let content = '';

      if (currentScreen === 'dashboard') {
        content = `
          <div style="padding: 32px;">
            <div style="margin-bottom: 24px;">
              <h1 class="page-title">Dashboard</h1>
              <p class="page-subtitle">AI-Powered Healthcare Platform</p>
            </div>
            
            <div class="grid grid-cols-3 gap-6 mb-8">
              <div class="stat-card" onclick="switchScreen('patients')">
                <div class="stat-label">Total Patients</div>
                <div class="stat-number">${DB.patients.length}</div>
              </div>
              <div class="stat-card" onclick="switchScreen('examinations')">
                <div class="stat-label">Examinations</div>
                <div class="stat-number">${DB.examinations.length}</div>
              </div>
              <div class="stat-card" onclick="switchScreen('ai')">
                <div class="stat-label">AI Features</div>
                <div class="stat-number">3</div>
                <div style="font-size: 13px; color: var(--purple); font-weight: 600;">Active</div>
              </div>
            </div>

            <div class="card">
              <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 20px;">ü§ñ AI-Powered Features</h3>
              <div class="grid grid-cols-3 gap-4">
                <div class="ai-card" onclick="openModal('aiPrescriptionModal')">
                  <div style="font-size: 32px; margin-bottom: 8px;">üíä</div>
                  <div style="font-weight: 700; font-size: 16px; margin-bottom: 4px;">AI Prescription</div>
                  <div style="font-size: 13px; opacity: 0.9;">Generate treatment plans</div>
                </div>
                <div class="ai-card" onclick="openModal('aiReportModal')">
                  <div style="font-size: 32px; margin-bottom: 8px;">üìä</div>
                  <div style="font-weight: 700; font-size: 16px; margin-bottom: 4px;">AI Report Analyzer</div>
                  <div style="font-size: 13px; opacity: 0.9;">Analyze lab reports</div>
                </div>
                <div class="ai-card" onclick="openModal('aiSymptomModal')">
                  <div style="font-size: 32px; margin-bottom: 8px;">üí¨</div>
                  <div style="font-weight: 700; font-size: 16px; margin-bottom: 4px;">AI Symptom Checker</div>
                  <div style="font-size: 13px; opacity: 0.9;">Check symptoms</div>
                </div>
              </div>
            </div>
          </div>
        `;
      } else if (currentScreen === 'ai') {
        content = `
          <div style="padding: 32px;">
            <div style="margin-bottom: 24px;">
              <h1 class="page-title">ü§ñ AI-Powered Features</h1>
              <p class="page-subtitle">Advanced AI tools for better healthcare</p>
            </div>

            <div class="grid grid-cols-2 gap-6">
              <div class="card" style="cursor: pointer;" onclick="openModal('aiPrescriptionModal')">
                <div style="display: flex; align-items: start; gap: 16px;">
                  <div style="font-size: 48px;">üíä</div>
                  <div style="flex: 1;">
                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--purple);">AI Prescription Generator</h3>
                    <p style="color: var(--text-light); margin-bottom: 12px;">Generate evidence-based treatment plans with dosage calculations based on patient age, weight, and allergies.</p>
                    <span class="badge badge-success">Active</span>
                  </div>
                </div>
              </div>

              <div class="card" style="cursor: pointer;" onclick="openModal('aiReportModal')">
                <div style="display: flex; align-items: start; gap: 16px;">
                  <div style="font-size: 48px;">üìä</div>
                  <div style="flex: 1;">
                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--purple);">AI Report Analyzer</h3>
                    <p style="color: var(--text-light); margin-bottom: 12px;">Analyze lab reports, blood tests, and medical documents with AI-powered insights and recommendations.</p>
                    <span class="badge badge-success">Active</span>
                  </div>
                </div>
              </div>

              <div class="card" style="cursor: pointer;" onclick="openModal('aiSymptomModal')">
                <div style="display: flex; align-items: start; gap: 16px;">
                  <div style="font-size: 48px;">üí¨</div>
                  <div style="flex: 1;">
                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--purple);">AI Symptom Checker</h3>
                    <p style="color: var(--text-light); margin-bottom: 12px;">Analyze patient symptoms and get possible diagnoses with probability scores and urgency levels.</p>
                    <span class="badge badge-success">Active</span>
                  </div>
                </div>
              </div>

              <div class="card">
                <div style="display: flex; align-items: start; gap: 16px;">
                  <div style="font-size: 48px;">üõ°Ô∏è</div>
                  <div style="flex: 1;">
                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--success);">Drug Safety System</h3>
                    <p style="color: var(--text-light); margin-bottom: 12px;">100+ drug database with interaction checking, allergy alerts, and severity warnings.</p>
                    <span class="badge badge-success">Active</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      } else if (currentScreen === 'patients') {
        content = `
          <div style="padding: 32px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <div>
                <h1 class="page-title">Patients</h1>
                <p class="page-subtitle">Manage all registered patients</p>
              </div>
              <button onclick="openModal('patientModal')" class="btn btn-primary">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                Register Patient
              </button>
            </div>

            <div class="card">
              <table>
                <thead>
                  <tr>
                    <th>Patient ID</th>
                    <th>Name</th>
                    <th>Age</th>
                    <th>Gender</th>
                    <th>Blood Group</th>
                    <th>Contact</th>
                  </tr>
                </thead>
                <tbody>
                  ${DB.patients.map(p => `
                    <tr>
                      <td><span class="badge badge-primary">${p.patient_id}</span></td>
                      <td style="font-weight: 600;">${p.first_name} ${p.last_name}</td>
                      <td>${p.age} years</td>
                      <td>${p.gender}</td>
                      <td><span class="badge badge-danger">${p.blood_group}</span></td>
                      <td style="font-size: 13px;">${p.phone}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else if (currentScreen === 'examinations') {
        content = `
          <div style="padding: 32px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <div>
                <h1 class="page-title">Examinations</h1>
                <p class="page-subtitle">View and manage patient examinations</p>
              </div>
              <button onclick="openModal('examModal')" class="btn btn-primary">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                New Examination
              </button>
            </div>

            <div class="card">
              ${DB.examinations.length === 0 ? `
                <div style="text-align: center; padding: 60px 20px;">
                  <div style="font-size: 64px; margin-bottom: 16px; opacity: 0.3;">ü©∫</div>
                  <div style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">No examinations yet</div>
                  <div style="font-size: 14px; color: var(--text-light); margin-bottom: 24px;">Start by creating your first patient examination</div>
                  <button onclick="openModal('examModal')" class="btn btn-primary">Create Examination</button>
                </div>
              ` : `
                <table>
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Patient</th>
                      <th>Chief Complaint</th>
                      <th>Diagnosis</th>
                      <th>Vitals</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${DB.examinations.map(e => {
                      const p = DB.patients.find(pt => pt.id === e.patient_id);
                      return `
                        <tr>
                          <td>${e.date}</td>
                          <td style="font-weight: 600;">${p.first_name} ${p.last_name}</td>
                          <td style="font-size: 13px;">${e.chief_complaint}</td>
                          <td><span class="badge badge-success">${e.diagnosis}</span></td>
                          <td style="font-size: 13px;">BP: ${e.vitals.bp || 'N/A'}</td>
                        </tr>
                      `;
                    }).join('')}
                  </tbody>
                </table>
              `}
            </div>
          </div>
        `;
      }

      app.innerHTML = `${header}<div style="display: flex;">${sidebar}<div style="flex: 1; background: #F8F9FA; min-height: calc(100vh - 65px);">${content}</div></div>`;
    }

    // Load data
    const savedPatients = localStorage.getItem('patients');
    const savedExams = localStorage.getItem('examinations');
    if (savedPatients) DB.patients = JSON.parse(savedPatients);
    if (savedExams) DB.examinations = JSON.parse(savedExams);

    render();
    console.log('‚úÖ MediScript Pro - Phase 1 Complete!');
    console.log('AI Features: Prescription Generator, Report Analyzer, Symptom Checker');
    console.log('Drug Database: 100+ drugs with interaction checking');
    console.log('Safety: Allergy alerts, Drug interactions, Severity warnings');
  </script>
</body>
</html>